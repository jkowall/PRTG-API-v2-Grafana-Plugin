/*! For license information please see module.js.LICENSE.txt */
define(["@grafana/data","@grafana/runtime","react","@grafana/ui"],(e,t,s,n)=>(()=>{"use strict";var r={7:e=>{e.exports=n},20:(e,t,s)=>{var n=s(959),r=Symbol.for("react.element"),a=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,s){var n,l={},c=null,u=null;for(n in void 0!==s&&(c=""+s),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,n)&&!i.hasOwnProperty(n)&&(l[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===l[n]&&(l[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:u,props:l,_owner:o.current}}t.jsx=l,t.jsxs=l},531:e=>{e.exports=t},781:t=>{t.exports=e},848:(e,t,s)=>{e.exports=s(20)},959:e=>{e.exports=s}},a={};function o(e){var t=a[e];if(void 0!==t)return t.exports;var s=a[e]={exports:{}};return r[e](s,s.exports,o),s.exports}o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};o.r(i),o.d(i,{plugin:()=>O});var l=o(781),c=o(531);function u(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class d{async query(e){const{endpoint:t,filter:s,limit:n,offset:r}=e,a={};s&&(a.filter=s),void 0!==n&&(a.limit=n.toString()),void 0!==r&&(a.offset=r.toString());const o=this.buildUrl(t,a);try{var i;const e=await(0,c.getBackendSrv)().fetch({url:o,method:"GET",headers:this.getHeaders()}).toPromise();return{data:(null==e?void 0:e.data)||[],total:(null==e||null===(i=e.data)||void 0===i?void 0:i.length)||0,offset:r||0,limit:n||0}}catch(e){throw console.error("PRTG API request failed:",e),new Error(`Failed to fetch data from PRTG API: ${e}`)}}async testConnection(){try{const e=this.buildUrl("experimental/objects",{limit:"1"});await(0,c.getBackendSrv)().fetch({url:e,method:"GET",headers:this.getHeaders()}).toPromise()}catch(e){throw new Error(`Connection test failed: ${e}`)}}async getObjects(e,t,s){return this.query({endpoint:"experimental/objects",filter:e,limit:t,offset:s})}async getObjectsDown(e){return this.getObjects("status = down",e)}async getObjectsWarning(e){return this.getObjects("status = warning",e)}async getObjectsPaused(e){return this.getObjects("status = paused",e)}buildUrl(e,t={}){const s=new URL(`${this.baseUrl}/${e}`);return Object.entries(t).forEach(([e,t])=>{void 0!==t&&""!==t&&s.searchParams.append(e,t)}),s.toString()}getHeaders(){return{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json",Accept:"application/json"}}constructor(e){u(this,"baseUrl",void 0),u(this,"apiKey",void 0),this.baseUrl=`${e.url}:${e.port}/api/v2`,this.apiKey=e.apiKey}}class p extends l.DataSourceApi{async query(e){const t=[];for(const s of e.targets)if(!s.hide&&s.endpoint)try{const e=await this.apiClient.query({endpoint:s.endpoint,filter:s.filter,limit:s.limit,offset:s.offset}),n=new l.MutableDataFrame({refId:s.refId,fields:this.createFields(e.data,s.columns)});for(const t of e.data)n.add(this.transformObjectToRow(t,s.columns));t.push(n)}catch(e){console.error("PRTG API Error:",e);const n=new l.MutableDataFrame({refId:s.refId,fields:[{name:"Error",type:l.FieldType.string}]});n.add({Error:`Failed to fetch data: ${e}`}),t.push(n)}return{data:t}}async testDatasource(){try{return await this.apiClient.testConnection(),{status:"success",message:"Successfully connected to PRTG API v2"}}catch(e){return{status:"error",message:`Failed to connect: ${e}`}}}createFields(e,t){if(!e.length)return[];const s=e[0];return(t||Object.keys(s)).map(e=>({name:this.formatFieldName(e),type:this.getFieldType(s[e])}))}formatFieldName(e){return e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}getFieldType(e){return"number"==typeof e?l.FieldType.number:"boolean"==typeof e?l.FieldType.boolean:e instanceof Date||"string"==typeof e&&!isNaN(Date.parse(e))?l.FieldType.time:l.FieldType.string}transformObjectToRow(e,t){const s=t||Object.keys(e),n={};for(const t of s){const s=e[t];if(t.includes(".")){const[s,r]=t.split("."),a=e[s];n[this.formatFieldName(t)]=(null==a?void 0:a[r])||null}else n[this.formatFieldName(t)]=s}return n}constructor(e){var t,s;super(e),s=void 0,(t="apiClient")in this?Object.defineProperty(this,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[t]=s;const{url:n,port:r=1616,allowInsecure:a=!1}=e.jsonData,{apiKey:o=""}=e.decryptedSecureJsonData;this.apiClient=new d({url:n||"",port:r,apiKey:o,allowInsecure:a})}}var h=o(848),f=o(959),m=o(7);function g(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const{SecretFormField:v,FormField:b}=m.LegacyForms;class y extends f.PureComponent{render(){const{options:e}=this.props,{jsonData:t,secureJsonFields:s}=e,n=e.secureJsonData||{};return(0,h.jsxs)("div",{className:"gf-form-group",children:[(0,h.jsx)("div",{className:"gf-form",children:(0,h.jsx)(b,{label:"PRTG Server URL",labelWidth:10,inputWidth:20,onChange:this.onURLChange,value:t.url||"",placeholder:"https://monitoring.prtg.server",tooltip:"The base URL of your PRTG server (without port)"})}),(0,h.jsx)("div",{className:"gf-form",children:(0,h.jsx)(b,{label:"Port",labelWidth:10,inputWidth:20,onChange:this.onPortChange,value:t.port||1616,placeholder:"1616",tooltip:"The port number for PRTG API v2 (default: 1616)",type:"number"})}),(0,h.jsxs)("div",{className:"gf-form",children:[(0,h.jsx)("div",{className:"gf-form-label width-10",children:"Options"}),(0,h.jsx)("div",{className:"gf-form-switch",children:(0,h.jsxs)("label",{className:"gf-form-label",children:[(0,h.jsx)("input",{type:"checkbox",checked:t.allowInsecure||!1,onChange:this.onAllowInsecureChange}),"Allow insecure SSL"]})})]}),(0,h.jsx)("div",{className:"gf-form-inline",children:(0,h.jsx)("div",{className:"gf-form",children:(0,h.jsx)(v,{isConfigured:s&&s.apiKey,value:n.apiKey||"",label:"API Key",placeholder:"Your PRTG API Key",labelWidth:10,inputWidth:20,onReset:this.onResetAPIKey,onChange:this.onAPIKeyChange,tooltip:"The API key for authenticating with PRTG (read-only recommended)"})})}),(0,h.jsx)("div",{className:"gf-form-group",children:(0,h.jsxs)("div",{className:"gf-form",children:[(0,h.jsx)("div",{className:"gf-form-label width-10",children:"Help"}),(0,h.jsx)("div",{className:"gf-form-label",children:(0,h.jsx)("p",{children:"Make sure PRTG API v2 is enabled on your server. You can find the API documentation at: https://your-prtg-server:1616/api/v2/oas/"})})]})})]})}constructor(...e){super(...e),g(this,"onURLChange",e=>{const{onOptionsChange:t,options:s}=this.props,n={...s.jsonData,url:e.target.value};t({...s,jsonData:n})}),g(this,"onPortChange",e=>{const{onOptionsChange:t,options:s}=this.props,n={...s.jsonData,port:parseInt(e.target.value,10)||1616};t({...s,jsonData:n})}),g(this,"onAllowInsecureChange",e=>{const{onOptionsChange:t,options:s}=this.props,n={...s.jsonData,allowInsecure:e.target.checked};t({...s,jsonData:n})}),g(this,"onAPIKeyChange",e=>{const{onOptionsChange:t,options:s}=this.props;t({...s,secureJsonData:{apiKey:e.target.value}})}),g(this,"onResetAPIKey",()=>{const{onOptionsChange:e,options:t}=this.props;e({...t,secureJsonFields:{...t.secureJsonFields,apiKey:!1},secureJsonData:{...t.secureJsonData,apiKey:""}})})}}function j(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const{FormField:C}=m.LegacyForms,x=[{label:"Objects (Experimental)",value:"experimental/objects"},{label:"Sensors",value:"sensors"},{label:"Devices",value:"devices"},{label:"Groups",value:"groups"},{label:"Probes",value:"probes"}],P=[{label:"All Objects",value:""},{label:"Down Status",value:"status = down"},{label:"Warning Status",value:"status = warning"},{label:"Paused Status",value:"status = paused"},{label:"Up Status",value:"status = up"},{label:"Custom Filter",value:"custom"}],w=["name","status","message","parent.name","lastup","lastdown","kind_name","objid","device","group","probe"];class N extends f.PureComponent{render(){const e={...this.props.query},{endpoint:t,filter:s,limit:n,offset:r,columns:a}=e,o=x.find(e=>e.value===t)||x[0],i=s&&!P.find(e=>e.value===s),l=i?P.find(e=>"custom"===e.value):P.find(e=>e.value===s)||P[0];return(0,h.jsxs)("div",{className:"gf-form-group",children:[(0,h.jsx)("div",{className:"gf-form",children:(0,h.jsx)(m.InlineField,{label:"Endpoint",labelWidth:12,children:(0,h.jsx)(m.Select,{options:x,value:o,onChange:this.onEndpointChange,width:30})})}),(0,h.jsx)("div",{className:"gf-form",children:(0,h.jsx)(m.InlineField,{label:"Filter",labelWidth:12,children:(0,h.jsx)(m.Select,{options:P,value:l,onChange:this.onFilterChange,width:30})})}),(i||"custom"===(null==l?void 0:l.value))&&(0,h.jsx)("div",{className:"gf-form",children:(0,h.jsx)(C,{label:"Custom Filter",labelWidth:12,inputWidth:30,onChange:this.onCustomFilterChange,value:s||"",placeholder:"e.g., status = down AND name contains 'server'",tooltip:"Use PRTG API v2 filter syntax"})}),(0,h.jsx)("div",{className:"gf-form",children:(0,h.jsx)(C,{label:"Limit",labelWidth:12,inputWidth:15,onChange:this.onLimitChange,value:(null==n?void 0:n.toString())||"",placeholder:"0 (no limit)",tooltip:"Maximum number of results to return",type:"number"})}),(0,h.jsx)("div",{className:"gf-form",children:(0,h.jsx)(C,{label:"Offset",labelWidth:12,inputWidth:15,onChange:this.onOffsetChange,value:(null==r?void 0:r.toString())||"",placeholder:"0",tooltip:"Number of results to skip",type:"number"})}),(0,h.jsx)("div",{className:"gf-form",children:(0,h.jsx)(C,{label:"Columns",labelWidth:12,inputWidth:30,onChange:this.onColumnsChange,value:(null==a?void 0:a.join(", "))||"",placeholder:"name, status, message, parent.name",tooltip:`Comma-separated list of columns to display. Common columns: ${w.join(", ")}`})}),(0,h.jsx)("div",{className:"gf-form-group",children:(0,h.jsxs)("div",{className:"gf-form",children:[(0,h.jsx)("div",{className:"gf-form-label width-12",children:"Help"}),(0,h.jsx)("div",{className:"gf-form-label",children:(0,h.jsx)("small",{children:'Use the PRTG API v2 syntax for filters. Examples: "status = down", "name contains \'server\'", "status = warning AND device = \'router\'"'})})]})})]})}constructor(...e){super(...e),j(this,"onEndpointChange",e=>{const{onChange:t,query:s}=this.props;t({...s,endpoint:e.value})}),j(this,"onFilterChange",e=>{const{onChange:t,query:s}=this.props;"custom"===e.value?t({...s,filter:""}):t({...s,filter:e.value})}),j(this,"onCustomFilterChange",e=>{const{onChange:t,query:s}=this.props;t({...s,filter:e.target.value})}),j(this,"onLimitChange",e=>{const{onChange:t,query:s}=this.props,n=parseInt(e.target.value,10);t({...s,limit:isNaN(n)?void 0:n})}),j(this,"onOffsetChange",e=>{const{onChange:t,query:s}=this.props,n=parseInt(e.target.value,10);t({...s,offset:isNaN(n)?void 0:n})}),j(this,"onColumnsChange",e=>{const{onChange:t,query:s}=this.props,n=e.target.value.split(",").map(e=>e.trim()).filter(e=>e.length>0);t({...s,columns:n.length>0?n:void 0})})}}const O=new l.DataSourcePlugin(p).setConfigEditor(y).setQueryEditor(N);return i})());
//# sourceMappingURL=module.js.map